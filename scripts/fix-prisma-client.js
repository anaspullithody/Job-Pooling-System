#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

const prismaClientPath = path.join(
  __dirname,
  '..',
  'node_modules',
  '.prisma',
  'client'
);

console.log('üîß Fixing Prisma Client for Next.js/Turbopack...');

// Create default.js - must be valid JS, not reference .ts files
const defaultJs = `// Prisma Client default export for Next.js/Turbopack
// This file is auto-generated by scripts/fix-prisma-client.js
// Re-export everything from the client module (TypeScript definitions are in default.d.ts)
const clientModule = require('./index-node.cjs');
module.exports = clientModule;
module.exports.PrismaClient = clientModule.PrismaClient;
module.exports.Prisma = clientModule.Prisma;
`;

// Create index-browser.js
const indexBrowserJs = `// Browser stub - Prisma should not be used in browser components
// This file is auto-generated by scripts/fix-prisma-client.js
module.exports = {};
`;

try {
  // Write default.js
  fs.writeFileSync(path.join(prismaClientPath, 'default.js'), defaultJs);
  console.log('‚úÖ Created default.js');

  // Write index-browser.js
  fs.writeFileSync(
    path.join(prismaClientPath, 'index-browser.js'),
    indexBrowserJs
  );
  console.log('‚úÖ Created index-browser.js');

  console.log('‚úÖ Prisma Client fixed successfully!');
} catch (error) {
  console.error('‚ùå Error fixing Prisma Client:', error.message);
  process.exit(1);
}
